require 'spec_helper'

describe "Account Transaction Creation" do

  def api
    AriaBilling
  end

  describe "self.authorize_electronic_payment(params)",:vcr do 
    it "Authorize a credit card for a specified amount" do
      response = api.authorize_electronic_payment ({ "account_number" => 1, "amount" => 20000 })

      response.should have_key("error_code")
      response.should have_key("error_msg")
      response.should have_key("proc_cw_response")
      response.should have_key("proc_avs_response")
      response.should have_key("proc_cvv_response")
      response.should have_key("proc_status_code")
      response.should have_key("proc_status_text")
      response.should have_key("proc_payment_id")
      response.should have_key("proc_auth_code")
      response.should have_key("proc_merch_comments")
    end
  end

   describe "self.collect_from_account(params)",:vcr do 
    it "Collects a specified amount from a specified account holder using the electronic method of payment on file" do
      response = api.collect_from_account ({ "account_no" => 1, "amount_to_collect" => 20000 })

      response.should have_key("error_code")
      response.should have_key("error_msg")
      response.should have_key("proc_cw_response")
      response.should have_key("proc_avs_response")
      response.should have_key("proc_cvv_response")
      response.should have_key("proc_status_code")
      response.should have_key("proc_status_text")
      response.should have_key("proc_payment_id")
      response.should have_key("proc_auth_code")
      response.should have_key("proc_merch_comments")
      response.should have_key("transaction_id")
    end
  end

  describe "self.create_order(params)",:vcr do 
    it "Creates an invoice for one or more inventory items ordered by a specified account holder" do
      params = { "account_no" => 1, "client_sku" => 'Test', "units" => 2, "amount" => 20000, "unit_discount_amount" => 1000, "bill_immediately" => 1 }
      response = api.create_order params

      response.should have_key("order_no")
      response.should have_key("transaction_id")
      response.should have_key("statement_error_cd")
      response.should have_key("statement_error_msg")
      response.should have_key("error_code")
      response.should have_key("error_msg")
      response.should have_key("proc_cw_response")
      response.should have_key("proc_avs_response")
      response.should have_key("proc_cvv_response")
      response.should have_key("proc_status_code")
      response.should have_key("proc_status_text")
      response.should have_key("proc_payment_id")
      response.should have_key("proc_auth_code")
      response.should have_key("proc_merch_comments")
      
    end
  end
end